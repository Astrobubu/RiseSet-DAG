<!DOCTYPE html>
<html lang="en" dir="ltr">
    <head>
        <meta charset="utf-8" />
        <title>Celestial Rise and Set Times</title>
        <link rel="preconnect" href="https://fonts.gstatic.com" />
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css" />
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
        <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@800&display=swap" rel="stylesheet" />
        <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300&display=swap" rel="stylesheet" />
        <script src="astronomy.js"></script>
        <script src="tiff.min.js"></script>
        <link rel="stylesheet" href="styles.css" />
        <script src="gifshot.js"></script>
    </head>
    <body>
        <br />
        <br />
        <br />
        <br />
        <br />
        <div class="row">
            <div class="">
                <img id="logo" src="logo.png" alt="" />
            </div>
            <div class="">
                <h1>Celestial Rise and Set Times</h1>
                <h2 id="time"></h2>
            </div>
        </div>

        <br />
        <ul class="nav nav-pills mb-3 nav-justified" id="pills-tab" role="tablist">
            <li class="nav-item active container">
                <a class="nav-link show" id="pills-rise-tab" data-toggle="pill" href="#pills-rise" role="tab" aria-controls="pills-rise" aria-selected="true">Rise & Set</a>
            </li>
            <li class="nav-item container">
                <a class="nav-link" id="pills-sunspots-tab" data-toggle="pill" href="#pills-sunspots" role="tab" aria-controls="pills-sunspots" aria-selected="false">Sun & Sunspots</a>
            </li>
            <li class="nav-item container">
                <a class="nav-link" id="pills-moon-tab" data-toggle="pill" href="#pills-moon" role="tab" aria-controls="pills-moon" aria-selected="false">Moon Phase</a>
            </li>
            <li class="nav-item container">
                <a class="nav-link" id="pills-weather-satellite-tab" data-toggle="pill" href="#pills-weather-satellite" role="tab" aria-controls="pills-weather-satellite" aria-selected="false">Weather Satellite</a>
            </li>
            <li class="nav-item container">
                <a class="nav-link" id="pills-apod-tab" data-toggle="pill" href="#pills-apod" role="tab" aria-controls="pills-apod" aria-selected="false">APOD</a>
            </li>
            <li class="nav-item container">
                <a class="nav-link" id="pills-weather-tab" data-toggle="pill" href="#pills-weather" role="tab" aria-controls="pills-weather" aria-selected="false">Weather Data</a>
            </li>
        </ul>

        <div class="tab-content" id="pills-tabContent">
            <div class="tab-pane fade container active in" id="pills-rise" role="tabpanel" aria-labelledby="pills-rise-tab">
                <div class="col-sm card suncard">
                    <h3>Sun</h3>
                    <p id="sunr">Rise:</p>
                    <p id="suns">Set:</p>
                </div>
                <div class="col-sm card jupcard">
                    <h3>Jupiter</h3>
                    <p id="jupr">Rise:</p>
                    <p id="jups">Set:</p>
                </div>
                <div class="col-sm card satcard">
                    <h3>Saturn</h3>
                    <p id="satr">Rise:</p>
                    <p id="sats">Set:</p>
                </div>
                <div class="col-sm card marscard">
                    <h3>Mars</h3>
                    <p id="marr">Rise:</p>
                    <p id="mars">Set:</p>
                </div>
                <div class="col-sm card vencard">
                    <h3>Venus</h3>
                    <p id="venr">Rise:</p>
                    <p id="vens">Set:</p>
                </div>
                <div class="col-sm card mooncard">
                    <h3>Moon</h3>
                    <p id="moonr">Rise:</p>
                    <p id="moons">Set:</p>
                </div>
            </div>
            <div class="tab-pane fade container" id="pills-sunspots" role="tabpanel" aria-labelledby="pills-sunspots-tab">
                <!-- <h3>Moon Phase</h3> -->
                <!-- <p id="moonp">Phase:</p> -->
                <h3>Sunspots Today</h3>
                <img id="sunspots" src="" class="blended" alt="Sunspots Today" width="720" />

                <h3>Sun from the SDO Space Telescope Today</h3>
                <img id="sdosun" src="" class="blended" alt="Sun Space" width="720" />
                <br />
            </div>
            <div class="tab-pane fade container" id="pills-moon" role="tabpanel" aria-labelledby="pills-moon-tab">
                <h3>Moon Today</h3>
                <img id="moonimg" class="blended" src="" alt="Moon Phase" width="640" />

                <img id="orbit" src="" class="blended" alt="" width="720" />
                <br />
                <img id="comp" src="" class="blended" alt="" width="1080" />
                <br />
            </div>
            <div class="tab-pane fade container" id="pills-weather-satellite" role="tabpanel" aria-labelledby="pills-weather-satellite-tab">
                <h3>Weather in Infra-Red wavelength</h3>
                <img id="insat3dIR" class="blended" src="" width="1080" alt="" />
                <br />
                <h3>Weather in Visual wavelength</h3>
                <img id="insat3dV" class="blended" src="" width="1080" alt="" />
                <br />

                <h3>Weather in Water Vapor reflection wavelength</h3>
                <img id="insat3dWV" class="blended" src="" width="1080" alt="" />
                <br />

                <h3>Weather in Water Vapor GIF</h3>
                <img id="insat3dWVGIF" class="blended" src="" width="1080" alt="" />
                <br />

                <h3>Weather in Infra-Red GIF</h3>
                <img id="insat3dIRGIF" class="blended" src="" width="1080" alt="" />
                <br />

                <h3>Meteosat IR Full</h3>
                <img id="MeteosatIRF" class="blended" src="" width="1080" alt="" />

                <h3>Meteosat IR Middle East</h3>
                <img id="MeteosatIRME" class="blended" src="" width="1080" alt="" />
                <br />

                <h3>Meteosat Water Vapor Full</h3>
                <img id="MeteosatWVF" class="blended" src="" width="1080" alt="" />
                <br />

                <h3>Meteosat Water Vapor Middle East</h3>
                <img id="MeteosatWVME" class="blended" src="" width="1080" alt="" />

                <h3>Meteosat Visible Full</h3>
                <img id="MeteosatVisF" class="blended" src="" width="1080" alt="" />
                <br />

                <h3>Meteosat Visible Middle East</h3>
                <img id="MeteosatVisME" class="blended" src="" width="1080" alt="" />
                <br />

                <h3>Meteosat Visible Middle East GIF - 3 Hour update</h3>
                <img id="MeteosatVisGIF" class="blended" src="" width="1080" alt="" />
                <br />

                <h3>Meteosat IR Middle East GIF - 3 Hour update</h3>
                <img id="MeteosatIRGIF" class="blended" src="" width="1080" alt="" />
                <br />

                <h3>Meteosat8</h3>
                <div class="" id="ewsgl"></div>

                <h3>Meteosat Indian Ocean Data Coverage</h3>
                <div class="" id="metiodc"></div>

                <h3>FY2G - India Ocean InfraRed Satellite</h3>
                <div class="" id="FY2G"></div>

                <h3>MET-PRIME - Africa, Europe, Atlantic Ocean Water Vapor Satellite</h3>
                <div class="" id="metprime"></div>

                <h3>Meteosat</h3>
                <div class="" id="">
                    <img id="meteosat_03" src="" alt="" />
                </div>
            </div>
            <div class="tab-pane fade container" id="pills-apod" role="tabpanel" aria-labelledby="pills-apod-tab">
                <h3>Astronomy Picutre of the Day</h3>
                <h4 id="apodtitle"></h4>
                <img id="apod" src="" class="blended" alt="" />
                <h4 id="apodexp"></h4>
            </div>
            <div class="tab-pane fade container" id="pills-weather" role="tabpanel" aria-labelledby="pills-weather-tab">
                <div class="weathered container">
                    <div class="col-sm cardsm">
                        <p id="temp" class="bigfont"></p>
                        <p>Temperature</p>
                    </div>
                    <div class="col-sm cardsm">
                        <p id="pressure_mb" class="bigfont"></p>
                        <p>Pressure</p>
                    </div>
                    <div class="col-sm cardsm">
                        <p id="humidity" class="bigfont"></p>
                        <p>Humidity</p>
                    </div>
                    <div class="col-sm cardsm">
                        <p id="uv" class="bigfont"></p>
                        <p>UV Index</p>
                    </div>
                    <div class="col-sm cardsm">
                        <p id="precip_mm" class="bigfont"></p>
                        <p>Precipitation</p>
                    </div>
                    <div class="col-sm cardsm">
                        <p id="clouds" class="bigfont"></p>
                        <p>Clouds Sensor</p>
                    </div>
                    <div class="col-sm cardsm">
                        <p id="condition" class="bigfont"></p>
                        <p>Weather Type</p>
                    </div>
                    <div class="col-sm cardsm">
                        <p id="vis_km" class="bigfont"></p>
                        <p>Visibility Distance</p>
                    </div>
                    <div class="col-sm cardsm">
                        <p id="wind_degree" class="bigfont"></p>
                        <p>Wind Degree</p>
                    </div>
                    <div class="col-sm cardsm">
                        <p id="wind_dir" class="bigfont"></p>
                        <p>Wind Direction</p>
                    </div>
                    <div class="col-sm cardsm">
                        <p id="wind_kph" class="bigfont"></p>
                        <p>Wind Speed</p>
                    </div>
                    <div id="gustbox" class="col-sm cardsm">
                        <p id="gust" class="bigfont"></p>
                        <p>Wind Gust Speed</p>
                    </div>

                    <div class="col-md card2">
                        <p id="vis_miles" class="bigfont"></p>
                        <p>Visibility Quality</p>
                    </div>
                </div>
                <p id="last_updated"></p>
            </div>
        </div>

        <script>
            window.onload = function () {
                function TiffLoader(link, tag) {
                    var xhr = new XMLHttpRequest();
                    xhr.responseType = "arraybuffer";
                    xhr.open("GET", link);
                    xhr.onload = function (e) {
                        var tiff = new Tiff({ buffer: xhr.response });
                        var canvas = tiff.toCanvas();
                        var img = canvas.toDataURL("image/png");
                        $("#" + tag).attr("src", img);
                    };
                    xhr.send();
                }
                function LastImgDirectory(link, tag, filenumber) {
                    $.get(link, function (data) {
                        var ewsgl = new Array($('a[href$=".jpg"]', data));
                        for (var i = 0; i < filenumber; i++) {
                            $("#" + tag).prepend($("<img>", { src: link + $(ewsgl[0].slice(-filenumber)[i]).attr("href") }));
                        }
                    });
                }
                function LastImgDirectoryspecific(link, tag, filenumber, pattern) {
                    $.get(link, function (data) {
                        var ewsgl = new Array($('a[href$="' + pattern + '"]', data));
                        for (var i = 0; i < filenumber; i++) {
                            $("#" + tag).prepend($("<img>", { src: link + $(ewsgl[0].slice(-filenumber)[i]).attr("href") }));
                        }
                    });
                }
                function changeImage(imagetag, imagelist, index, millisecs) {
                    $(imagetag).attr("src", imagelist[index]);
                    console.log(index + "  " + imagelist[index]);
                    index++;
                    if (index >= Object.keys(imagelist).length) {
                        index = 0;
                    }
                    var timerFunc = function () {
                        changeImage(imagetag, imagelist, index, millisecs);
                    };
                    var timer = setTimeout(timerFunc, millisecs);
                    // changeImage("#meteosat_03", meteosat03, meteosat_03_index, 1000)
                }
                function Pad(s, w) {
                    s = s.toFixed(0);
                    while (s.length < w) {
                        s = "0" + s;
                    }
                    return s;
                }
                function Formapate(date) {
                    var year = Pad(date.getFullYear(), 4);
                    var month = Pad(1 + date.getMonth(), 2);
                    var day = Pad(date.getDate(), 2);
                    var hour = Pad(date.getHours(), 2);
                    var minute = Pad(date.getMinutes(), 2);
                    var second = Pad(date.getSeconds(), 2);
                    var ampm = date.toLocaleString([], { hour: "2-digit", minute: "2-digit" });
                    // // return `${year}-${month}-${day} ${hour}:${minute}:${second}`;
                    return `${ampm}`;
                }
                function UpdateClock() {
                    var today = new Date();
                    var dateo = today.getFullYear() + "-" + (today.getMonth() + 1) + "-" + today.getDate();
                    var time = today.toLocaleString([], { hour: "2-digit", minute: "2-digit" });
                    var dateTime = dateo + " \n " + time;

                    $("#time").text(dateTime);
                    setTimeout(UpdateClock, 60000);
                }
                // Tab Cycle function
                var tabChange = function () {
                    var tabs = $(".nav-pills > li");
                    var active = tabs.filter(".active");
                    var next = active.next("li").length ? active.next("li").find("a") : tabs.filter(":first-child").find("a");
                    // Bootsrap tab show, para ativar a tab
                    next.tab("show");
                };
                var tabCycle = setInterval(tabChange, 30000);
                $(function () {
                    $(".nav-pills a").click(function (e) {
                        e.preventDefault();

                        clearInterval(tabCycle);

                        $(this).tab("show");

                        setTimeout(function () {
                            tabCycle = setInterval(tabChange, 120000);
                        }, 1000);
                    });
                });
                function UpdateImages(){
                  // LastImgDirectory("https://www.ssec.wisc.edu/data/geo/images/met-iodc/animation_images/","metiodc",11);
                  // LastImgDirectory("https://www.ssec.wisc.edu/data/geo/images/ews-g1/animation_images/","ewsgl",5);
                  // LastImgDirectory("https://www.ssec.wisc.edu/data/geo/images/fy2g/animation_images/","FY2G",4);
                  // LastImgDirectoryspecific("https://www.ssec.wisc.edu/data/geo/images/met-prime/animation_images/","metprime",11,"fd.jpg");

                  // $("#moonimg").attr("src", "https://svs.gsfc.nasa.gov/vis/a000000/a004800/a004874/frames/730x730_1x1_30p/moon." + ("0" + (dayofyear * 24 - 24 + today.getHours())).slice(-4) + ".jpg");

                  // TiffLoader("https://svs.gsfc.nasa.gov/vis/a000000/a004800/a004874/frames/850x850_1x1_30p/orbit." + ("0" + (dayofyear * 24 - 24 + today.getHours())).slice(-4) + ".tif", "orbit");
                  // TiffLoader("https://svs.gsfc.nasa.gov/vis/a000000/a004800/a004874/frames/1920x1080_16x9_30p/fancy/comp." + ("0" + (dayofyear * 24 - 24 + today.getHours())).slice(-4) + ".tif", "comp");
                  //
                  // $("#sunspots").attr("src", "https://sdo.gsfc.nasa.gov/assets/img/latest/latest_1024_HMIIC.jpg");
                  // $("#sdosun").attr("src", "https://sdo.gsfc.nasa.gov/assets/img/latest/latest_1024_0171.jpg");
                  // $("#insat3dIR").attr("src", "https://mausam.imd.gov.in/Satellite/rswmo_ir1.jpg");
                  // $("#insat3dV").attr("src", "https://mausam.imd.gov.in/Satellite/3Dasiasec_vis.jpg");
                  // $("#insat3dWV").attr("src", "https://mausam.imd.gov.in/Satellite/3Dasiasec_wv.jpg");
                  // $("#insat3dWVGIF").attr("src", "https://mausam.imd.gov.in/Satellite/Converted/WV.gif");
                  // $("#insat3dIRGIF").attr("src", "https://mausam.imd.gov.in/Satellite/Converted/IR1.gif");
                  // $("#MeteosatIRF").attr("src", "https://eumetview.eumetsat.int/static-images/latestImages/EUMETSAT_MSGIODC_IR108Color_FullResolution.jpg");
                  // $("#MeteosatIRME").attr("src", "https://eumetview.eumetsat.int/static-images/latestImages/EUMETSAT_MSGIODC_IR108Color_MiddleEast.jpg");
                  // $("#MeteosatWVF").attr("src", "https://eumetview.eumetsat.int/static-images/latestImages/EUMETSAT_MSGIODC_WV062_MiddleEast.jpg");
                  // $("#MeteosatWVME").attr("src", "https://eumetview.eumetsat.int/static-images/latestImages/EUMETSAT_MSGIODC_WV062_FullResolution.jpg");
                  // $("#MeteosatVisF").attr("src", "https://eumetview.eumetsat.int/static-images/latestImages/EUMETSAT_MSGIODC_VIS006Color_FullResolution.jpg");
                  // $("#MeteosatVisME").attr("src", "https://eumetview.eumetsat.int/static-images/latestImages/EUMETSAT_MSGIODC_VIS006Color_MiddleEast.jpg");
                  // $("#MeteosatVisGIF").attr("src", "https://img.allmetsat.com/sat/anim-msg-arabia-viscol.gif");
                  // $("#MeteosatIRGIF").attr("src", "https://img.allmetsat.com/sat/anim-msg-arabia-ircol.gif");
                  setTimeout(UpdateImages, 10800000);
                }
                function UpdateScreen() {
                    // Day of year
                    var today = new Date();
                    var start = new Date(today.getFullYear(), 0, 0);
                    var diff = today - start;
                    var oneDay = 1000 * 60 * 60 * 24;
                    var dayofyear = Math.floor(diff / oneDay);

                    var meteosat03 = [];
                    var meteosat_03_index = 0;
                    $.get("https://www.ssec.wisc.edu/data/geo/images/met-iodc/animation_images/", function (data) {
                        var meteosat03data = new Array($('a[href$="03_fd.jpg"]', data));
                        for (var i = 0; i < 26; i++) {
                            meteosat03.push("https://www.ssec.wisc.edu/data/geo/images/met-iodc/animation_images/" + $(meteosat03data[0].slice(-26)[i]).attr("href"));
                        }

                        gifshot.createGIF(
                            {
                                images: meteosat03,
                                gifWidth: 1000,
                                gifHeight: 1000,
                                interval: 1,
                            },
                            function (obj) {
                                if (!obj.error) {
                                    $("#meteosat_03").attr("src", obj.image);
                                }
                            }
                        );
                    });

                    $.getJSON("https://api.weatherapi.com/v1/current.json?key=ef773d319e9b4e95a4c203245212401&q=DXB", function (data) {
                        // console.log(data)

                        $("#clouds").text(data.current.cloud);
                        $("#condition").text(data.current.condition.text);
                        $("#temp").text(data.current.temp_c + " C°");
                        $("#gust").text(data.current.gust_kph + " km/h");
                        $("#humidity").text(data.current.humidity + "%");
                        $("#last_updated").text("Last Updated: " + data.current.last_updated);
                        $("#precip_mm").text(data.current.precip_mm + " mm");
                        $("#pressure_mb").text(data.current.pressure_mb + " mb");
                        $("#uv").text(data.current.uv);
                        $("#vis_km").text(data.current.vis_km + " km");
                        $("#wind_degree").text(data.current.wind_degree + "°");
                        $("#wind_dir").text(data.current.wind_dir);
                        $("#wind_kph").text(data.current.wind_kph + " km/h");

                        if (data.current.vis_miles <= 0) {
                            $("#vis_miles").text("Dense fog, objects not visible at 45 m");
                        } else if (data.current.vis_miles <= 1) {
                            $("#vis_miles").text("Thick fog, objects not visible at 200 m");
                        } else if (data.current.vis_miles <= 2) {
                            $("#vis_miles").text("Fog, objects not visible at 400 m");
                        } else if (data.current.vis_miles <= 3) {
                            $("#vis_miles").text("Moderate fog, objects not visible at 800 m");
                        } else if (data.current.vis_miles <= 4) {
                            $("#vis_miles").text("Thin fog or mist, objects not visible at 1 km");
                        } else if (data.current.vis_miles <= 5) {
                            $("#vis_miles").text("Visibility poor, objects not visible at 3 km");
                        } else if (data.current.vis_miles <= 6) {
                            $("#vis_miles").text("Visibility moderate, objects not visible at 10 km");
                        } else if (data.current.vis_miles <= 7) {
                            $("#vis_miles").text("Visibility good, objects not visible at 15 km");
                        } else if (data.current.vis_miles <= 8) {
                            $("#vis_miles").text("Visibility very good, objects not visible at 50 km");
                        } else if (data.current.vis_miles <= 9) {
                            $("#vis_miles").text("Visibility excellent, objects visible more than 50 km");
                        }
                    });

                    let text_latitude = 25.276987;
                    let text_longitude = 55.296249;
                    let text_elevation = 10;
                    let date = new Date();

                    let latitude = parseFloat(text_latitude);
                    let longitude = parseFloat(text_longitude);
                    let elevation = parseFloat(text_elevation);

                    let observer = Astronomy.MakeObserver(latitude, longitude, elevation);
                    // var phase = Astronomy.MoonPhase(date);
                    let sunrise = Astronomy.SearchRiseSet("Sun", observer, +1, date, 300);
                    let sunset = Astronomy.SearchRiseSet("Sun", observer, -1, date, 300);
                    let moonrise = Astronomy.SearchRiseSet("Moon", observer, +1, date, 300);
                    let moonset = Astronomy.SearchRiseSet("Moon", observer, -1, date, 300);
                    let juprise = Astronomy.SearchRiseSet("Jupiter", observer, +1, date, 300);
                    let jupset = Astronomy.SearchRiseSet("Jupiter", observer, -1, date, 300);
                    let satrise = Astronomy.SearchRiseSet("Saturn", observer, +1, date, 300);
                    let satset = Astronomy.SearchRiseSet("Saturn", observer, -1, date, 300);
                    let marsrise = Astronomy.SearchRiseSet("Mars", observer, +1, date, 300);
                    let marsset = Astronomy.SearchRiseSet("Mars", observer, -1, date, 300);
                    let venrise = Astronomy.SearchRiseSet("Venus", observer, +1, date, 300);
                    let venset = Astronomy.SearchRiseSet("Venus", observer, -1, date, 300);

                    // $("#moonp").text("Phase: " + phase.toFixed(3));
                    // console.log(sunrise.date.getHours());
                    // console.log(sunset.date.getHours());
                    // console.log(juprise.date);
                    // console.log(jupset.date);
                    // if (sunrise.date< juprise.date) {console.log("TES")}
                    // console.log(marsrise.date);
                    // console.log(marsset.date);
                    let sunr = sunrise ? Formapate(sunrise.date) : "";
                    $("#sunr").text("Rise: " + sunr);

                    let suns = sunset ? Formapate(sunset.date) : "";
                    $("#suns").text("Set: " + suns);

                    let jupr = jupset ? Formapate(juprise.date) : "";
                    $("#jupr").text("Rise: " + jupr);

                    let jups = jupset ? Formapate(jupset.date) : "";
                    $("#jups").text("Set: " + jups);

                    let satr = satrise ? Formapate(satrise.date) : "";
                    $("#satr").text("Rise: " + satr);

                    let sats = satset ? Formapate(satset.date) : "";
                    $("#sats").text("Set: " + sats);

                    let marr = marsrise ? Formapate(marsrise.date) : "";
                    $("#marr").text("Rise: " + marr);

                    let mars = marsset ? Formapate(marsset.date) : "";
                    $("#mars").text("Set: " + mars);

                    let venr = venrise ? Formapate(venrise.date) : "";
                    $("#venr").text("Rise: " + venr);

                    let vens = venset ? Formapate(venset.date) : "";
                    $("#vens").text("Set: " + vens);

                    let moonr = moonrise ? Formapate(moonrise.date) : "";
                    $("#moonr").text("Rise: " + moonr);

                    let moons = moonset ? Formapate(moonset.date) : "";
                    $("#moons").text("Set: " + moons);



                    $.getJSON("https://api.nasa.gov/planetary/apod?api_key=vpa4GReiOx8IhT5Gy942c7b2mESJk7CmE3iopbZf", function (data) {
                        var apodurl = `${data.url}`;
                        var apodtitle = `${data.title}`;
                        var apodexp = `${data.explanation}`;
                        $("#apod").attr("src", apodurl);
                        $("#apodexp").text(apodexp);
                        $("#apodtitle").text(apodtitle);
                    });
                    setTimeout(UpdateScreen, 3600000);
                }

                UpdateClock();
                UpdateImages();
                UpdateScreen();
            };
        </script>
    </body>
</html>
